# user center

## 数据的设计

- 尽可能将业务逻辑设计到数据里面，如通过code可以知道某个人所再单位，任职等信息，然后通过code进行数据权限的过滤等。


## sync data to 3rd app

三方应用有场景获取全部的组织和用户数据，之前，将数据推送到三方，需要每天同步，数据不能实时获取，同步数据期间又导致了三方应用不可用，理论应该提供丰富和高性能的查询接口实时查询。但三方应用需要基于全量数据的基础之上进行操作，如oa在系统内部进行授权操作。所以还需要考虑数据同步的问题。如果仅仅是查询接口，则需要考虑大批量查询和简单查询的区分，对单个应用的限制等。大批量的查询数据准备时间会比较久。所以还是建议大批量的走异步数据推送。针对每天必须全量的问题，则通过支持三方应用传入最后时间来支持三方的增量数据更新。并且增量的更新也可以在单个小时内完成。

最后，必须要保持旧版本，单条数据推送的方式，因为很多isv不会再去修改。另外，重构之前的同步接口，支持传入参数，如版本号，更新时间等，同时支持新版本批量推送数据的方式。为了旧版本不影响新版本，需要维护两个任务队列。两个线程各自独立运行。

组装数据效果过于低下，并且多次组装会造成内存的泄露，因此考虑使用redis缓存全量数据，组装一次之后考虑缓存起来给多次使用。
